#include <windows.h>
#include <stdio.h>

/**
 * https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-messageboxa
 int MessageBoxA(
  HWND   hWnd,
  LPCSTR lpText,
  LPCSTR lpCaption,
  UINT   uType
);

 */ 
//typedef int(WINAPI *_MessageBoxA)(HWND, LPCSTR, LPCSTR, UINT);

typedef int (WINAPI * _MessageBoxA)(
  HWND,
  LPCSTR,
  LPCSTR,
  UINT   uType
);

int main(){
    HMODULE hModule = LoadLibraryA("User32.dll");
    if( hModule == NULL){
        printf("Failed to get handle to User32.dll Because of %d\n", GetLastError());
        return 0 ;
    }
    _MessageBoxA f = NULL;
    
    if (hModule != NULL){
        f = (_MessageBoxA)(GetProcAddress(hModule, "MessageBoxA"));
        if( f != NULL){
            (*f)(NULL, "Hello there from User32.dll", "I was dynamically loaded!", MB_OK);
        }
    
    printf("Virtual Address of User32.dll:%p\n", (void*)hModule);
    printf("Virtual Address of User32.dll$MessageBoxA:%p\n", (void*)f);
    printf("Relative Virtual Address of User32.dll$MessageBoxA:%p\n", (void*) ( (UINT_PTR)f -(UINT_PTR) hModule ));
    FreeLibrary(hModule);
    }
}
