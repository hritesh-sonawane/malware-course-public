from flask import Flask, request, jsonify
import random
app = Flask(__name__)

@app.route("/hello")
def hello():
    return "Hello world!"

@app.route("/double/<integer>", methods=["GET"])
def double(integer:int):
    return f"Your doubled number is {int(integer) * 2}"


@app.route("/echo", methods =["POST"])
def echo_request():
    pass

@app.route("/whoami", methods = ["GET", "POST"])
def task_whoami():
    #print(request.__dict__)
    if request.method == "GET":
        print("Tasking client with `whoami`")
        return "whoami"
    else:
        print(request.data)
        return "Thank you!"

@app.route("/tasks", methods = ["GET", "POST"])
def handle_tasks():
    if request.method == "GET":
        task = random.choice(["whoami", "hostname", "double"])
        args = []
        if task == "double":
            args.append(12)
        return jsonify({"cmd": task, "args": args})
    else:
        try:
            data = request.json
        except Exception as e:
            print("Failed to json decode", Exception, e)
            return jsonify({})
        print("Got results!" ,data)
        return "Thank you!"



if __name__ == "__main__":
    app.run()



