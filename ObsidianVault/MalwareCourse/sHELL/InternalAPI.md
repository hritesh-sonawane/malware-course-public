The `InternalAPI` structure is a crucial component of the sHELL project, acting as a bridge between each plugin and the shell's core functionalities. This structure allows plugins to access essential services without directly depending on the standard C library or other external libraries, adhering to the project's constraint of using only the Windows API and custom implementations. Understanding how `InternalAPI` works is key to developing plugins for sHELL.

### Structure Overview

`InternalAPI` is defined as follows:
```c
typedef struct InternalAPI {
    // Print functions
    void (*wprintf)(const wchar_t *format, ...);
    void (*debug_wprintf)(const wchar_t *format, ...);

    // Memory management functions
    void *(*malloc)(size_t size);
    void (*free)(void *ptr);
    void *(*calloc)(size_t num, size_t size);
    void *(*realloc)(void *ptr, size_t newSize);

    // String and utility functions
    size_t (*strlen)(const char *str);
    size_t (*wstrlen)(const wchar_t *str);
    int (*strcmp)(const char *str1, const char *str2);
    char *(*strcpy)(char *dest, const char *src);
    unsigned long (*dbj2Hash)(const char *str);
    void (*stripnewline)(char *str);
    void *(*memset)(void *ptr, int value, size_t num);
} InternalAPI;
```

### Key Components

- **Print Functions**: These functions allow plugins to output text to the console. `wprintf` is used for wide character strings, while `debug_wprintf` might be used for debugging purposes, offering a consistent way to log messages.
    
- **Memory Management Functions**: These are wrappers around the standard memory allocation and deallocation functions, providing a unified interface for managing memory within plugins. They replace the standard `malloc`, `free`, `calloc`, and `realloc` functions.
    
- **String and Utility Functions**: This subset includes functions for string manipulation and other utility operations. It encompasses functions for getting string lengths (`strlen` and `wstrlen`), comparing strings (`strcmp`), copying strings (`strcpy`), hashing (`dbj2Hash`), removing newlines from strings (`stripnewline`), and setting memory (`memset`).
    

### How It Works

When a plugin is initialized (through the `CommandInit` function), the shell passes a pointer to an `InternalAPI` instance. This instance provides the plugin with access to all the functions defined within the structure. Plugins should use these functions for output, memory management, and any other utility operations they need to perform, instead of directly calling the corresponding C standard library or Windows API functions.

### Usage Example

Here's how a plugin might use `InternalAPI`:

```c
InternalAPI *core = NULL;

__declspec(dllexport) void CommandInit(InternalAPI *lpCore) {
    core = lpCore;
}

__declspec(dllexport) DWORD CommandRun(int argc, char **argv) {
    // Use core->malloc to allocate memory
    char *buffer = (char *)core->malloc(100 * sizeof(char));

    // Use core->wprintf to print a message
    core->wprintf(L"Allocated memory at %p\n", buffer);

    // Remember to free allocated memory
    core->free(buffer);

    return 0;
}

```
### Conclusion

`InternalAPI` is designed to standardize how plugins interact with external functionalities, ensuring that all plugins can operate under the constraints of the sHELL project. By utilizing `InternalAPI`, plugins can remain lightweight and portable, with a clear and consistent interface for accessing essential services.