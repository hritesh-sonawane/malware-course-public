#!/bin/bash

# install compiler, gpg, other utilities 
sudo apt-get install -y build-essential mingw-w64 gpg wget zsh git curl tmux  unzip 
sudo apt-get install -y nasm

# install text editor/ide
sudo apt-get install -y vim 

# install vscode 
wget -O- https://packages.microsoft.com/keys/microsoft.asc | sudo gpg --dearmor | sudo tee /usr/share/keyrings/vscode.gpg
echo deb [arch=amd64 signed-by=/usr/share/keyrings/vscode.gpg] https://packages.microsoft.com/repos/vscode stable main | sudo tee /etc/apt/sources.list.d/vscode.list
sudo apt-get update
sudo apt-get install -y code


# install analysis tools 
sudo apt-get install -y  mitmproxy socat

# https://unix.stackexchange.com/questions/367866/how-to-choose-a-response-for-interactive-prompt-during-installation-from-a-shell/413011#413011
echo "wireshark-common wireshark-common/install-setuid boolean true" | sudo debconf-set-selections
sudo DEBIAN_FRONTEND=noninteractive apt-get -y install wireshark


## install inetsim
echo "deb http://www.inetsim.org/debian/ binary/" > /etc/apt/sources.list.d/inetsim.list
echo "deb-src http://www.inetsim.org/debian/ source/" >> /etc/apt/sources.list.d/inetsim.list

wget -O - https://www.inetsim.org/inetsim-archive-signing-key.asc | apt-key add -
sudo apt-get update
sudo apt-get install -y inetsim 


# we want to control when this gets run 
sudo systemctl disable inetsim 

# PE-bear
wget https://github.com/hasherezade/pe-bear/releases/download/v0.6.1/PE-bear_0.6.1_qt5.14_x64_linux.tar.xz
tar xfv PE-bear_0.6.1_qt5.14_x64_linux.tar.xz
sudo mv PE-bear /usr/local/bin/

## Cleanup artifacts
rm capstone_LICENSE.TXT



# install python 
sudo apt-get install -y python3-pip python3-venv

# install ghidra

sudo apt-get install -y openjdk-17-jdk openjdk-17-jre
wget https://github.com/NationalSecurityAgency/ghidra/releases/download/Ghidra_10.2.2_build/ghidra_10.2.2_PUBLIC_20221115.zip
unzip ghidra_10.2.2_PUBLIC_20221115.zip

export GHIDRA_RUN=$HOME/ghidra_10.2.2_PUBLIC/ghidraRun
chmod +x  $GHIDRA_RUN

echo "export PATH=\$PATH:$(pwd)/ghidra_10.2.2_PUBLIC/" >> ~/.bashrc
## install ghidrathon
sudo add-apt-repository -y  ppa:cwchien/gradle
sudo apt-get install -y gradle 
git clone https://github.com/mandiant/Ghidrathon.git

### create virtual env 
python3 -m venv ghidra_env

### activate env
source ghidra_env/bin/activate

cd $HOME/Ghidrathon/
gradle -PGHIDRA_INSTALL_DIR=$HOME/ghidra_10.2.2_PUBLIC
cd $HOME
cp $HOME/Ghidrathon/dist/*.zip $HOME/ghidra_10.2.2_PUBLIC/Extensions/Ghidra/

### Optional: install Dark mode for Ghidra
git clone https://github.com/zackelia/ghidra-dark.git
python3 ghidra-dark/install.py --path $HOME/ghidra_10.2.2_PUBLIC/
 

# Tools from Remnux that are handy 
wget https://raw.githubusercontent.com/REMnux/distro/master/files/mynic
chmod +x mynic
sudo mv mynic /usr/local/bin 


wget https://raw.githubusercontent.com/REMnux/distro/master/files/accept-all-ips
chmod +x accept-all-ips
sudo mv accept-all-ips /usr/local/bin/

# tor ,  wireguard 
sudo apt-get install -y tor  